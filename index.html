<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chronos-X ë´‡ ê´€ë¦¬ íŒ¨ë„</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;600;700&family=Pretendard:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â”€â”€â”€ ë³€ìˆ˜ â”€â”€â”€ */
:root {
  --bg0: #080C0A;
  --bg1: #0D1410;
  --bg2: #111A14;
  --bg3: #162019;
  --border: #1E3028;
  --border2: #2A4035;
  --g0: #00FF7F;
  --g1: #00CC65;
  --g2: #009948;
  --gdim: rgba(0,255,127,0.12);
  --gdim2: rgba(0,255,127,0.06);
  --orange: #FF8C42;
  --red: #FF4560;
  --yellow: #FFD166;
  --blue: #06D6FF;
  --txt: #B8D4C0;
  --txt2: #5A7A64;
  --txt3: #3A5040;
  --white: #E8F4EC;
  --mono: 'IBM Plex Mono', monospace;
  --sans: 'Pretendard', 'Noto Sans KR', sans-serif;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;min-height:100vh;background:var(--bg0);color:var(--txt);font-family:var(--sans);overflow-x:hidden}

/* â”€â”€â”€ ë°°ê²½ íš¨ê³¼ â”€â”€â”€ */
body::before{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:
    radial-gradient(ellipse 60% 40% at 20% 10%, rgba(0,255,127,0.04) 0%, transparent 70%),
    radial-gradient(ellipse 40% 60% at 80% 90%, rgba(0,153,72,0.04) 0%, transparent 70%);
}
body::after{
  content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background-image:
    linear-gradient(rgba(0,255,127,0.025) 1px,transparent 1px),
    linear-gradient(90deg,rgba(0,255,127,0.025) 1px,transparent 1px);
  background-size:48px 48px;
}

/* â”€â”€â”€ ë¡œê·¸ì¸ â”€â”€â”€ */
#loginScreen{
  position:fixed;inset:0;z-index:200;
  display:flex;align-items:center;justify-content:center;
  background:var(--bg0);
}
.lbox{
  width:440px;position:relative;
  background:var(--bg1);
  border:1px solid var(--border2);
  border-radius:2px;
  padding:52px 48px;
  animation:slideUp .5s cubic-bezier(.16,1,.3,1);
}
@keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.lbox::before{
  content:'';position:absolute;top:0;left:0;right:0;height:2px;
  background:linear-gradient(90deg,transparent 0%,var(--g0) 40%,var(--g1) 60%,transparent 100%);
}
.lbox::after{
  content:'';position:absolute;
  top:2px;left:50%;transform:translateX(-50%);
  width:60px;height:1px;
  background:var(--g0);
  box-shadow:0 0 16px 4px rgba(0,255,127,0.4);
}
.l-eyebrow{
  font-family:var(--mono);font-size:10px;letter-spacing:4px;
  color:var(--g1);text-transform:uppercase;margin-bottom:10px;
}
.l-title{font-size:24px;font-weight:700;color:var(--white);margin-bottom:6px;line-height:1.2}
.l-sub{font-size:13px;color:var(--txt2);margin-bottom:36px;line-height:1.6}

.seg{display:flex;background:var(--bg0);border:1px solid var(--border);border-radius:2px;padding:3px;gap:3px;margin-bottom:32px}
.seg-btn{
  flex:1;padding:9px;background:transparent;border:none;cursor:pointer;
  font-family:var(--sans);font-size:13px;color:var(--txt2);border-radius:1px;
  transition:all .2s;
}
.seg-btn.on{background:var(--gdim);color:var(--g0);box-shadow:inset 0 0 0 1px rgba(0,255,127,0.2)}

.fl{display:flex;flex-direction:column;gap:6px;margin-bottom:18px}
.fl-label{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2)}
.fi{
  width:100%;background:rgba(255,255,255,0.03);
  border:1px solid var(--border);border-radius:2px;
  padding:11px 14px;color:var(--white);
  font-family:var(--mono);font-size:13px;outline:none;
  transition:border-color .2s,box-shadow .2s;
}
.fi:focus{border-color:var(--g1);box-shadow:0 0 0 3px rgba(0,255,127,0.08)}
.fi::placeholder{color:var(--txt3)}

.lbtn{
  width:100%;margin-top:6px;padding:13px;
  background:var(--g0);border:none;
  color:#040A06;font-family:var(--mono);font-size:12px;
  font-weight:700;letter-spacing:3px;cursor:pointer;border-radius:2px;
  transition:all .2s;
}
.lbtn:hover{background:#33FF99;box-shadow:0 0 24px rgba(0,255,127,0.35)}
.lbtn:active{transform:scale(.99)}
.lerr{color:var(--red);font-size:12px;margin-top:12px;text-align:center;min-height:18px;font-family:var(--mono)}

/* â”€â”€â”€ ëŒ€ì‹œë³´ë“œ â”€â”€â”€ */
#app{display:none;min-height:100vh;position:relative;z-index:1;flex-direction:column}
#app.show{display:flex}

/* íƒ‘ë°” */
.topbar{
  height:54px;display:flex;align-items:center;justify-content:space-between;
  padding:0 28px;
  background:rgba(13,20,16,0.9);
  border-bottom:1px solid var(--border);
  position:sticky;top:0;z-index:100;
  backdrop-filter:blur(12px);
  flex-shrink:0;
}
.tb-left{display:flex;align-items:center;gap:16px}
.brand{font-family:var(--mono);font-size:13px;letter-spacing:3px;color:var(--g0)}
.brand span{color:var(--txt2)}
.online-pill{
  display:flex;align-items:center;gap:6px;
  background:rgba(0,255,127,0.06);border:1px solid rgba(0,255,127,0.15);
  padding:3px 10px;border-radius:999px;font-size:11px;color:var(--g1);
  font-family:var(--mono);
}
.dot{width:6px;height:6px;border-radius:50%;background:var(--g0);box-shadow:0 0 6px var(--g0);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.tb-right{display:flex;align-items:center;gap:12px}
.role-chip{
  padding:4px 10px;border-radius:2px;font-size:10px;
  font-family:var(--mono);letter-spacing:1px;font-weight:700;
}
.role-chip.super{background:rgba(255,140,66,0.12);color:var(--orange);border:1px solid rgba(255,140,66,0.25)}
.role-chip.owner{background:rgba(0,255,127,0.08);color:var(--g0);border:1px solid rgba(0,255,127,0.2)}
.api-chip{
  font-family:var(--mono);font-size:10px;color:var(--txt2);
  background:var(--bg2);border:1px solid var(--border);
  padding:4px 10px;border-radius:2px;max-width:180px;
  overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}
.lout-btn{
  padding:5px 12px;border:1px solid var(--border2);background:transparent;
  color:var(--txt2);font-size:11px;cursor:pointer;border-radius:2px;
  font-family:var(--mono);transition:all .2s;
}
.lout-btn:hover{border-color:var(--red);color:var(--red)}

/* ë°”ë”” */
.body{display:flex;flex:1;min-height:0}

/* ì‚¬ì´ë“œë°” */
.sidebar{
  width:210px;flex-shrink:0;
  background:var(--bg1);
  border-right:1px solid var(--border);
  padding:20px 0;
  display:flex;flex-direction:column;gap:4px;
}
.nav-group{margin-bottom:8px}
.nav-group-label{
  font-family:var(--mono);font-size:9px;letter-spacing:3px;
  text-transform:uppercase;color:var(--txt3);
  padding:0 16px 6px;
}
.nv{
  display:flex;align-items:center;gap:10px;
  padding:9px 16px;cursor:pointer;font-size:13px;color:var(--txt2);
  border-left:2px solid transparent;transition:all .15s;
  margin:0 0 1px;
}
.nv:hover{color:var(--txt);background:var(--gdim2)}
.nv.active{color:var(--g0);background:var(--gdim);border-left-color:var(--g0)}
.nv-icon{font-size:14px;width:18px;text-align:center;flex-shrink:0}
.nv-lock{font-size:9px;margin-left:auto;color:var(--txt3)}

/* ë©”ì¸ */
.main{flex:1;padding:32px;overflow-y:auto;min-width:0}
.page{display:none}
.page.active{display:block;animation:fadeIn .25s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

.pg-header{margin-bottom:28px}
.pg-title{font-size:22px;font-weight:700;color:var(--white);margin-bottom:4px}
.pg-sub{font-size:13px;color:var(--txt2)}

/* ì¹´ë“œ */
.card{
  background:var(--bg1);border:1px solid var(--border);
  border-radius:2px;padding:24px;margin-bottom:20px;
  position:relative;overflow:hidden;
}
.card-top{
  position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,var(--g2),transparent 50%);opacity:.4;
}
.c-title{
  font-size:12px;font-weight:600;color:var(--txt);
  display:flex;align-items:center;gap:8px;margin-bottom:18px;
  font-family:var(--mono);letter-spacing:1px;text-transform:uppercase;
}

/* ìŠ¤íƒ¯ */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
.stat{background:var(--bg2);border:1px solid var(--border);border-radius:2px;padding:18px 20px}
.stat-k{font-family:var(--mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);margin-bottom:8px}
.stat-v{font-family:var(--mono);font-size:26px;font-weight:700;line-height:1}
.stat-v.g{color:var(--g0)}
.stat-v.r{color:var(--red)}
.stat-v.o{color:var(--orange)}
.stat-v.b{color:var(--blue)}

/* í¼ */
.frow{display:flex;gap:12px;align-items:flex-end;margin-bottom:0}
.fg{flex:1;display:flex;flex-direction:column;gap:6px}
.flabel{font-family:var(--mono);font-size:10px;letter-spacing:1.5px;text-transform:uppercase;color:var(--txt2)}
.fin,.fsel,.fta{
  width:100%;background:rgba(255,255,255,0.025);
  border:1px solid var(--border);border-radius:2px;
  padding:10px 12px;color:var(--white);
  font-family:var(--sans);font-size:13px;outline:none;
  transition:border-color .2s;
}
.fin:focus,.fsel:focus,.fta:focus{border-color:var(--g1)}
.fin::placeholder,.fta::placeholder{color:var(--txt3)}
.fsel option{background:var(--bg2)}
.fta{resize:vertical;min-height:88px}

/* ë²„íŠ¼ */
.btn{padding:10px 18px;border-radius:2px;font-size:11px;font-family:var(--mono);letter-spacing:1.5px;cursor:pointer;transition:all .2s;border:none;white-space:nowrap;font-weight:600}
.btn-g{background:var(--g0);color:#040A06}
.btn-g:hover{background:#33FF99;box-shadow:0 0 16px rgba(0,255,127,0.3)}
.btn-r{background:rgba(255,69,96,0.1);color:var(--red);border:1px solid rgba(255,69,96,0.25)}
.btn-r:hover{background:rgba(255,69,96,0.2)}
.btn-o{background:rgba(255,140,66,0.1);color:var(--orange);border:1px solid rgba(255,140,66,0.25)}
.btn-o:hover{background:rgba(255,140,66,0.2)}
.btn-ghost{background:transparent;color:var(--txt2);border:1px solid var(--border)}
.btn-ghost:hover{border-color:var(--border2);color:var(--txt)}
.btn-b{background:rgba(6,214,255,0.1);color:var(--blue);border:1px solid rgba(6,214,255,0.25)}
.btn-b:hover{background:rgba(6,214,255,0.18)}
.btn:disabled{opacity:.4;cursor:not-allowed}

/* í…Œì´ë¸” */
.tw{overflow-x:auto}
table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:8px 14px;font-family:var(--mono);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);border-bottom:1px solid var(--border)}
td{padding:12px 14px;border-bottom:1px solid rgba(30,48,40,0.5);vertical-align:middle}
tr:hover td{background:rgba(0,255,127,0.02)}
.td-mono{font-family:var(--mono);font-size:11px;color:var(--txt2)}
.empty-row td{color:var(--txt2);text-align:center;padding:28px;font-size:13px}

/* ë±ƒì§€ */
.badge{display:inline-block;padding:3px 8px;border-radius:2px;font-size:10px;font-family:var(--mono);letter-spacing:.5px;font-weight:700}
.bsup{background:rgba(255,140,66,0.12);color:var(--orange)}
.badm{background:rgba(0,255,127,0.08);color:var(--g1)}
.busr{background:rgba(184,212,192,0.06);color:var(--txt2)}
.bban{background:rgba(255,69,96,0.12);color:var(--red)}

/* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
#toast{
  position:fixed;bottom:28px;right:28px;
  padding:13px 18px;border-radius:2px;
  font-size:12px;font-family:var(--mono);
  background:var(--bg2);border:1px solid var(--border2);
  z-index:9999;opacity:0;transform:translateY(8px);
  transition:all .3s cubic-bezier(.16,1,.3,1);
  pointer-events:none;max-width:300px;line-height:1.5;
}
#toast.show{opacity:1;transform:translateY(0)}
#toast.ok{border-color:var(--g1);color:var(--g0)}
#toast.er{border-color:var(--red);color:var(--red)}
#toast.wn{border-color:var(--yellow);color:var(--yellow)}

/* ëª¨ë‹¬ */
.moverlay{position:fixed;inset:0;background:rgba(4,8,6,0.85);z-index:500;display:none;align-items:center;justify-content:center;backdrop-filter:blur(6px)}
.moverlay.show{display:flex}
.modal{background:var(--bg1);border:1px solid var(--border2);border-radius:2px;padding:36px;width:460px;position:relative;animation:slideUp .3s cubic-bezier(.16,1,.3,1)}
.modal::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--red),transparent)}
.m-title{font-size:17px;font-weight:700;color:var(--white);margin-bottom:6px}
.m-sub{font-size:13px;color:var(--txt2);margin-bottom:24px;line-height:1.6}
.m-actions{display:flex;gap:10px;justify-content:flex-end}

/* ì„¹ì…˜ í—¤ë” */
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}

/* êµ¬ë¶„ì„  */
.div{height:1px;background:var(--border);margin:20px 0}

/* ë¹ ë¥¸ ì‹¤í–‰ */
.quick-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
.quick-card{
  background:var(--bg2);border:1px solid var(--border);
  border-radius:2px;padding:16px 20px;cursor:pointer;
  transition:all .2s;display:flex;align-items:center;gap:12px;
}
.quick-card:hover{border-color:var(--border2);background:var(--bg3)}
.quick-icon{font-size:20px}
.quick-label{font-size:13px;color:var(--txt);font-weight:500}
.quick-desc{font-size:11px;color:var(--txt2);margin-top:2px}

/* ë¡œê·¸ */
.log-row{display:flex;gap:12px;align-items:flex-start;padding:10px 14px;border-bottom:1px solid rgba(30,48,40,0.4);font-size:12px}
.log-t{font-family:var(--mono);color:var(--txt2);font-size:10px;flex-shrink:0;padding-top:1px;min-width:70px}
.log-tag{flex-shrink:0;font-family:var(--mono);font-size:9px;padding:2px 6px;border-radius:2px;letter-spacing:1px;font-weight:700}
.lt-ban{background:rgba(255,69,96,.12);color:var(--red)}
.lt-notice{background:rgba(6,214,255,.1);color:var(--blue)}
.lt-admin{background:rgba(255,209,102,.1);color:var(--yellow)}
.lt-system{background:rgba(0,255,127,.08);color:var(--g1)}
.log-msg{color:var(--txt)}

/* ì„¤ì • íŒ¨ë„ (ê´€ë¦¬ì ë¹„ë²ˆ ì„¤ì •) */
.pw-display{
  font-family:var(--mono);font-size:13px;
  background:var(--bg0);border:1px solid var(--border);
  padding:10px 14px;border-radius:2px;color:var(--g0);
  letter-spacing:2px;
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë¡œê·¸ì¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginScreen">
  <div class="lbox">
    <div class="l-eyebrow">Chronos-X Control Panel</div>
    <div class="l-title">ê´€ë¦¬ ì‹œìŠ¤í…œ</div>
    <div class="l-sub">ê¶Œí•œì— ë§ëŠ” ì—­í• ì„ ì„ íƒí•˜ê³ <br>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>

    <div class="seg">
      <button class="seg-btn on" id="tab-super" onclick="switchRole('super')">ğŸ‘‘ ì„œë²„ ê´€ë¦¬ì</button>
      <button class="seg-btn" id="tab-owner" onclick="switchRole('owner')">ğŸ  ë°©ì¥</button>
    </div>

    <!-- API URL ìë™ ê°ì§€ (ë´‡ ì„œë²„ì—ì„œ ì§ì ‘ ì—´ë¦¬ë¯€ë¡œ ì…ë ¥ ë¶ˆí•„ìš”) -->
    <input type="hidden" id="inApiUrl" value="" />
    <div style="background:var(--bg0);border:1px solid var(--border);border-radius:2px;padding:10px 14px;margin-bottom:18px;font-size:12px;color:var(--g1);font-family:var(--mono);display:flex;align-items:center;gap:8px">
      <span style="color:var(--g0)">â—</span>
      <span id="autoApiLabel">ì„œë²„ ìë™ ê°ì§€ ì¤‘...</span>
    </div>

    <div class="fl" id="superPwField">
      <div class="fl-label">ì„œë²„ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</div>
      <input class="fi" id="inSuperPw" type="password" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
    </div>

    <div id="ownerFields" style="display:none">
      <div class="fl">
        <div class="fl-label">ë°©ì¥ ë¹„ë°€ë²ˆí˜¸</div>
        <input class="fi" id="inOwnerPw" type="password" placeholder="ë°©ì¥ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" />
      </div>
      <div class="fl">
        <div class="fl-label">ë‚´ ë°© ID</div>
        <input class="fi" id="inRoomId" placeholder="!ë°©ì½”ë“œ ëª…ë ¹ì–´ë¡œ í™•ì¸" />
      </div>
    </div>

    <button class="lbtn" onclick="doLogin()">[ ì ‘ì† ]</button>
    <div class="lerr" id="lerr">&nbsp;</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ëŒ€ì‹œë³´ë“œ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app">
  <!-- íƒ‘ë°” -->
  <div class="topbar">
    <div class="tb-left">
      <div class="brand">CHRONOS<span>-X</span></div>
      <div class="online-pill"><span class="dot"></span>BOT ONLINE</div>
    </div>
    <div class="tb-right">
      <div class="api-chip" id="hApiUrl"></div>
      <div class="role-chip" id="hRole"></div>
      <button class="lout-btn" onclick="doLogout()">LOGOUT</button>
    </div>
  </div>

  <div class="body">
    <!-- ì‚¬ì´ë“œë°” -->
    <nav class="sidebar">
      <div class="nav-group">
        <div class="nav-group-label">Overview</div>
        <div class="nv active" onclick="nav('home',this)"><span class="nv-icon">â—ˆ</span>ëŒ€ì‹œë³´ë“œ</div>
      </div>
      <div class="nav-group">
        <div class="nav-group-label">ê³µí†µ ê¸°ëŠ¥</div>
        <div class="nv" onclick="nav('ban',this)"><span class="nv-icon">âŠ˜</span>ë°´ / ì–¸ë°´</div>
        <div class="nv" onclick="nav('notice',this)"><span class="nv-icon">â—</span>ê³µì§€ ì „ì†¡</div>
        <div class="nv" onclick="nav('addadmin',this)"><span class="nv-icon">â—‰</span>ê´€ë¦¬ì ì„ëª…</div>
        <div class="nv" onclick="nav('restart',this)"><span class="nv-icon">â†º</span>ë´‡ ì¬ì‹œì‘</div>
      </div>
      <div class="nav-group" id="superNav">
        <div class="nav-group-label">ê´€ë¦¬ì ì „ìš©</div>
        <div class="nv" onclick="nav('admins',this)"><span class="nv-icon">â¬¡</span>ê´€ë¦¬ì ëª©ë¡<span class="nv-lock">ğŸ”’</span></div>
        <div class="nv" onclick="nav('rooms',this)"><span class="nv-icon">â–£</span>ë°© ëª©ë¡<span class="nv-lock">ğŸ”’</span></div>
        <div class="nv" onclick="nav('settings',this)"><span class="nv-icon">â—§</span>ë¹„ë°€ë²ˆí˜¸ ì„¤ì •<span class="nv-lock">ğŸ”’</span></div>
        <div class="nv" onclick="nav('logs',this)"><span class="nv-icon">â‰¡</span>í™œë™ ë¡œê·¸<span class="nv-lock">ğŸ”’</span></div>
      </div>
    </nav>

    <!-- ë©”ì¸ -->
    <main class="main">

      <!-- í™ˆ -->
      <div class="page active" id="page-home">
        <div class="pg-header">
          <div class="pg-title">ëŒ€ì‹œë³´ë“œ</div>
          <div class="pg-sub" id="homeDesc">ì ‘ì† ì¤‘...</div>
        </div>
        <div class="stats">
          <div class="stat"><div class="stat-k">ê´€ë¦¬ ë°© ìˆ˜</div><div class="stat-v b" id="stRooms">â€”</div></div>
          <div class="stat"><div class="stat-k">ë“±ë¡ ê´€ë¦¬ì</div><div class="stat-v g" id="stAdmins">â€”</div></div>
          <div class="stat"><div class="stat-k">ì°¨ë‹¨ ìœ ì €</div><div class="stat-v r" id="stBans">â€”</div></div>
          <div class="stat"><div class="stat-k">ë´‡ ìƒíƒœ</div><div class="stat-v g" style="font-size:16px;padding-top:4px">â— ONLINE</div></div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">âš¡ ë¹ ë¥¸ ì‹¤í–‰</div>
          <div class="quick-grid">
            <div class="quick-card" onclick="nav('ban',null)"><span class="quick-icon">âŠ˜</span><div><div class="quick-label">ë°´ ê´€ë¦¬</div><div class="quick-desc">ìœ ì € ì°¨ë‹¨ Â· ì°¨ë‹¨ í•´ì œ Â· ë°´ ëª©ë¡</div></div></div>
            <div class="quick-card" onclick="nav('notice',null)"><span class="quick-icon">â—</span><div><div class="quick-label">ê³µì§€ ì „ì†¡</div><div class="quick-desc">ë°©ì— ê³µì§€ ë©”ì‹œì§€ ì¦‰ì‹œ ì „ì†¡</div></div></div>
            <div class="quick-card" onclick="nav('addadmin',null)"><span class="quick-icon">â—‰</span><div><div class="quick-label">ê´€ë¦¬ì ì„ëª…</div><div class="quick-desc">ìœ ì €ì—ê²Œ ì¼ë°˜ ê´€ë¦¬ì ê¶Œí•œ ë¶€ì—¬</div></div></div>
            <div class="quick-card" onclick="nav('restart',null)"><span class="quick-icon">â†º</span><div><div class="quick-label">ë´‡ ì¬ì‹œì‘</div><div class="quick-desc">ë´‡ ì„œë²„ ì¦‰ì‹œ ì¬ì‹œì‘</div></div></div>
          </div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">ğŸ“¡ ì ‘ì† ì •ë³´</div>
          <table>
            <tr><td style="color:var(--txt2);width:130px;font-size:12px">API ì£¼ì†Œ</td><td class="td-mono" id="iApi">â€”</td></tr>
            <tr><td style="color:var(--txt2);font-size:12px">ì ‘ì† ê¶Œí•œ</td><td id="iRole">â€”</td></tr>
            <tr><td style="color:var(--txt2);font-size:12px">ì ‘ì† ì‹œê°</td><td class="td-mono" id="iTime">â€”</td></tr>
            <tr id="iRoomRow" style="display:none"><td style="color:var(--txt2);font-size:12px">ë°© ID</td><td class="td-mono" id="iRoom">â€”</td></tr>
          </table>
        </div>
      </div>

      <!-- ë°´ ê´€ë¦¬ -->
      <div class="page" id="page-ban">
        <div class="pg-header">
          <div class="pg-title">ë°´ / ì–¸ë°´</div>
          <div class="pg-sub">ìœ ì €ë¥¼ ì°¨ë‹¨í•˜ê±°ë‚˜ í•´ì œí•©ë‹ˆë‹¤.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">ğŸš« ìœ ì € ì°¨ë‹¨</div>
          <div class="frow" style="gap:12px">
            <div class="fg"><div class="flabel">ë‹‰ë„¤ì„ ë˜ëŠ” ID</div><input class="fin" id="banTgt" placeholder="ì°¨ë‹¨í•  ìœ ì € ì…ë ¥" /></div>
            <div class="fg"><div class="flabel">ì°¨ë‹¨ ì‚¬ìœ </div><input class="fin" id="banRsn" placeholder="ì˜ˆ: ìš•ì„¤, ë„ë°°" /></div>
            <button class="btn btn-r" onclick="doBan()">ì°¨ë‹¨ ì‹¤í–‰</button>
          </div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">âœ… ì°¨ë‹¨ í•´ì œ</div>
          <div class="frow">
            <div class="fg"><div class="flabel">ë‹‰ë„¤ì„ ë˜ëŠ” ID</div><input class="fin" id="unbanTgt" placeholder="ì°¨ë‹¨ í•´ì œí•  ìœ ì €" /></div>
            <button class="btn btn-b" onclick="doUnban()">í•´ì œ ì‹¤í–‰</button>
          </div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="sh">
            <div class="c-title" style="margin:0">ğŸ“‹ ì°¨ë‹¨ ëª©ë¡</div>
            <button class="btn btn-ghost" onclick="loadBanList()">ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div class="tw">
            <table><thead><tr><th>#</th><th>ë‹‰ë„¤ì„</th><th>ID</th><th>ì‚¬ìœ </th><th>ì²˜ë¦¬ì</th><th>ì•¡ì…˜</th></tr></thead>
            <tbody id="banTbody"><tr class="empty-row"><td colspan="6">ìƒˆë¡œê³ ì¹¨ì„ ëˆŒëŸ¬ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”</td></tr></tbody></table>
          </div>
        </div>
      </div>

      <!-- ê³µì§€ ì „ì†¡ -->
      <div class="page" id="page-notice">
        <div class="pg-header">
          <div class="pg-title">ê³µì§€ ì „ì†¡</div>
          <div class="pg-sub">ë´‡ì´ ìˆëŠ” ë°©ì— ê³µì§€ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ë°©ì¥ì€ ìì‹ ì˜ ë°©ì—ë§Œ ì „ì†¡ë©ë‹ˆë‹¤.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">ğŸ“¢ ê³µì§€ ì‘ì„±</div>
          <div class="fg" style="margin-bottom:14px">
            <div class="flabel">ì „ì†¡ ë²”ìœ„</div>
            <select class="fsel" id="ntcScope">
              <option value="all">ì „ì²´ ë°© (ë´‡ì´ ìˆëŠ” ëª¨ë“  ë°©)</option>
              <option value="room">íŠ¹ì • ë°© ID</option>
            </select>
          </div>
          <div class="fg" id="ntcRoomGrp" style="display:none;margin-bottom:14px">
            <div class="flabel">ë°© ID</div>
            <input class="fin" id="ntcRoomId" placeholder="ë°© ID ì…ë ¥" />
          </div>
          <div class="fg" style="margin-bottom:16px">
            <div class="flabel">ë©”ì‹œì§€</div>
            <textarea class="fta" id="ntcMsg" placeholder="ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
          </div>
          <div style="display:flex;gap:12px;align-items:center">
            <button class="btn btn-g" onclick="doNotice()">ê³µì§€ ì „ì†¡</button>
            <span style="font-size:11px;color:var(--txt2)">âš  ì „ì²´ ì „ì†¡ ì‹œ ëª¨ë“  ë°©ì— ì¦‰ì‹œ ë°œì†¡ë©ë‹ˆë‹¤</span>
          </div>
        </div>
      </div>

      <!-- ê´€ë¦¬ì ì„ëª… -->
      <div class="page" id="page-addadmin">
        <div class="pg-header">
          <div class="pg-title">ê´€ë¦¬ì ì„ëª…</div>
          <div class="pg-sub">ìœ ì €ì—ê²Œ ì¼ë°˜ ê´€ë¦¬ì ê¶Œí•œì„ ë¶€ì—¬í•©ë‹ˆë‹¤.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">â• ì„ëª…í•˜ê¸°</div>
          <div style="margin-bottom:12px;padding:12px 14px;background:var(--bg0);border:1px solid var(--border);border-radius:2px;font-size:12px;color:var(--txt2);line-height:1.6">
            âš  ì„ëª…ëœ ì¼ë°˜ ê´€ë¦¬ìëŠ” ë°´/ì–¸ë°´, ê³µì§€ ì „ì†¡ ë“± ë°©ì¥ê³¼ ë™ì¼í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            ê´€ë¦¬ì <strong style="color:var(--txt)">í•´ì œ</strong>ëŠ” ì„œë²„ ê´€ë¦¬ì ì „ìš© ë©”ë‰´ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
          </div>
          <div class="frow">
            <div class="fg"><div class="flabel">ë‹‰ë„¤ì„ ë˜ëŠ” ID</div><input class="fin" id="addAdmTgt" placeholder="ì„ëª…í•  ìœ ì € ì…ë ¥" /></div>
            <button class="btn btn-g" onclick="doAddAdmin()">ì„ëª… ì‹¤í–‰</button>
          </div>
        </div>
      </div>

      <!-- ë´‡ ì¬ì‹œì‘ -->
      <div class="page" id="page-restart">
        <div class="pg-header">
          <div class="pg-title">ë´‡ ì¬ì‹œì‘</div>
          <div class="pg-sub">ë´‡ ì„œë²„ë¥¼ ì¦‰ì‹œ ì¬ì‹œì‘í•©ë‹ˆë‹¤.</div>
        </div>
        <div class="card" style="border-color:rgba(255,209,102,0.2)">
          <div class="card-top" style="background:linear-gradient(90deg,var(--yellow),transparent 50%)"></div>
          <div class="c-title">â†º ì¬ì‹œì‘ ì‹¤í–‰</div>
          <p style="font-size:13px;color:var(--txt2);margin-bottom:20px;line-height:1.7">
            ë´‡ ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ë©´ ì ê¹ ë™ì•ˆ ë´‡ì´ ì‘ë‹µí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            ìë™ìœ¼ë¡œ ì¬ì—°ê²°ë˜ë©°, ì•½ 5~10ì´ˆ í›„ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.
          </p>
          <button class="btn btn-o" onclick="showRestartConfirm()">â†º ì§€ê¸ˆ ì¬ì‹œì‘</button>
        </div>
      </div>

      <!-- ê´€ë¦¬ì ëª©ë¡ (ê´€ë¦¬ì ì „ìš©) -->
      <div class="page" id="page-admins">
        <div class="pg-header">
          <div class="pg-title">ê´€ë¦¬ì ëª©ë¡</div>
          <div class="pg-sub">ì„œë²„ ê´€ë¦¬ì ì „ìš© ë©”ë‰´ â€” ê´€ë¦¬ì í•´ì œ í¬í•¨.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="sh">
            <div class="c-title" style="margin:0">ğŸ“‹ ì „ì²´ ëª©ë¡</div>
            <div style="display:flex;gap:8px">
              <button class="btn btn-ghost" onclick="loadAdminList()">ìƒˆë¡œê³ ì¹¨</button>
              <button class="btn btn-r" onclick="confirmAct('clearAdmins')">ì¼ë°˜ ê´€ë¦¬ì ì „ì²´ í•´ì œ</button>
            </div>
          </div>
          <div class="tw">
            <table><thead><tr><th>#</th><th>ë‹‰ë„¤ì„</th><th>ê¶Œí•œ</th><th>ë°© ì½”ë“œ</th><th>ì•¡ì…˜</th></tr></thead>
            <tbody id="admTbody"><tr class="empty-row"><td colspan="5">ìƒˆë¡œê³ ì¹¨ì„ ëˆ„ë¥´ì„¸ìš”</td></tr></tbody></table>
          </div>
        </div>
      </div>

      <!-- ë°© ëª©ë¡ (ê´€ë¦¬ì ì „ìš©) -->
      <div class="page" id="page-rooms">
        <div class="pg-header">
          <div class="pg-title">ë°© ëª©ë¡</div>
          <div class="pg-sub">ë´‡ì´ ë°°ì¹˜ëœ ëª¨ë“  ë°© ëª©ë¡ì…ë‹ˆë‹¤.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="sh">
            <div class="c-title" style="margin:0">ğŸ  ë°© ëª©ë¡</div>
            <button class="btn btn-ghost" onclick="loadRooms()">ìƒˆë¡œê³ ì¹¨</button>
          </div>
          <div class="tw">
            <table><thead><tr><th>#</th><th>ë°© ID</th><th>ê³µì§€ ë³´ë‚´ê¸°</th></tr></thead>
            <tbody id="roomTbody"><tr class="empty-row"><td colspan="3">ìƒˆë¡œê³ ì¹¨ì„ ëˆ„ë¥´ì„¸ìš”</td></tr></tbody></table>
          </div>
        </div>
      </div>

      <!-- ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ê´€ë¦¬ì ì „ìš©) -->
      <div class="page" id="page-settings">
        <div class="pg-header">
          <div class="pg-title">ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</div>
          <div class="pg-sub">ëŒ€ì‹œë³´ë“œ ë¡œê·¸ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•©ë‹ˆë‹¤. ì„œë²„ ê´€ë¦¬ì ì „ìš©.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">ğŸ” ì„œë²„ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
          <div class="fg" style="margin-bottom:12px"><div class="flabel">ìƒˆ ë¹„ë°€ë²ˆí˜¸</div><input class="fin" id="newSuperPw" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" /></div>
          <div class="fg" style="margin-bottom:16px"><div class="flabel">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</div><input class="fin" id="newSuperPw2" type="password" placeholder="ë‹¤ì‹œ ì…ë ¥" /></div>
          <button class="btn btn-g" onclick="changePw('super')">ë³€ê²½</button>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div class="c-title">ğŸ”‘ ë°©ì¥ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
          <div class="fg" style="margin-bottom:12px"><div class="flabel">ìƒˆ ë¹„ë°€ë²ˆí˜¸</div><input class="fin" id="newOwnerPw" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" /></div>
          <div class="fg" style="margin-bottom:16px"><div class="flabel">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</div><input class="fin" id="newOwnerPw2" type="password" placeholder="ë‹¤ì‹œ ì…ë ¥" /></div>
          <button class="btn btn-b" onclick="changePw('owner')">ë³€ê²½</button>
        </div>
        <div class="card" style="border-color:rgba(255,69,96,0.2)">
          <div class="card-top" style="background:linear-gradient(90deg,var(--red),transparent 50%)"></div>
          <div class="c-title">âš  í˜„ì¬ ì„¤ì •ëœ ë¹„ë°€ë²ˆí˜¸ (ë³´ì•ˆ ì£¼ì˜)</div>
          <p style="font-size:11px;color:var(--txt2);margin-bottom:12px">ì‹¤ì œ ì„œë²„ ë°°í¬ ì‹œ ì´ ì„¹ì…˜ì€ ì œê±°í•˜ì„¸ìš”.</p>
          <table>
            <tr><td style="color:var(--txt2);font-size:12px;width:140px">ê´€ë¦¬ì ë¹„ë²ˆ</td><td><div class="pw-display" id="showSuperPw">â€”</div></td></tr>
            <tr><td style="color:var(--txt2);font-size:12px">ë°©ì¥ ë¹„ë²ˆ</td><td><div class="pw-display" id="showOwnerPw">â€”</div></td></tr>
          </table>
        </div>
      </div>

      <!-- í™œë™ ë¡œê·¸ -->
      <div class="page" id="page-logs">
        <div class="pg-header">
          <div class="pg-title">í™œë™ ë¡œê·¸</div>
          <div class="pg-sub">í˜„ì¬ ì„¸ì…˜ì˜ ì‘ì—… ì´ë ¥ì…ë‹ˆë‹¤.</div>
        </div>
        <div class="card">
          <div class="card-top"></div>
          <div id="logContainer">
            <div class="empty-row" style="padding:28px;text-align:center;color:var(--txt2);font-size:13px">ì•„ì§ ê¸°ë¡ ì—†ìŒ</div>
          </div>
        </div>
      </div>

    </main>
  </div>
</div>

<!-- ì¬ì‹œì‘ í™•ì¸ ëª¨ë‹¬ -->
<div class="moverlay" id="moverlay">
  <div class="modal">
    <div class="m-title" id="mTitle">í™•ì¸</div>
    <div class="m-sub" id="mSub">ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</div>
    <div class="m-actions">
      <button class="btn btn-ghost" onclick="closeModal()">ì·¨ì†Œ</button>
      <button class="btn btn-r" id="mOkBtn" onclick="execAction()">ì‹¤í–‰</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìƒíƒœ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  role: 'super',
  apiUrl: '',
  roomId: '',
  logs: [],
  pendingAction: null,
  // ë¹„ë°€ë²ˆí˜¸ (ì‹¤ì œ ìš´ì˜ ì‹œ ì„œë²„ì—ì„œ ê´€ë¦¬ ê¶Œì¥)
  passwords: {
    super: 'super1234',
    owner: 'owner1234'
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ìœ í‹¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='ok') {
  const el=document.getElementById('toast');
  el.textContent=msg; el.className=`show ${type}`;
  clearTimeout(el._t); el._t=setTimeout(()=>el.className='',3200);
}
function addLog(tag,msg){
  const t=new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
  S.logs.unshift({tag,msg,t});
  renderLogs();
}
function renderLogs(){
  const c=document.getElementById('logContainer');
  if(!S.logs.length){c.innerHTML='<div class="empty-row" style="padding:28px;text-align:center;color:var(--txt2);font-size:13px">ì•„ì§ ê¸°ë¡ ì—†ìŒ</div>';return;}
  c.innerHTML=S.logs.map(l=>`
    <div class="log-row">
      <span class="log-t">${l.t}</span>
      <span class="log-tag lt-${l.tag}">${l.tag.toUpperCase()}</span>
      <span class="log-msg">${l.msg}</span>
    </div>`).join('');
}
function maskId(id){const s=String(id||'');return s.length<=4?'****':s.slice(0,4)+'****';}

// â”€â”€ API í˜¸ì¶œ â”€â”€
async function api(path,method='POST',body=null){
  try{
    // ì¸ì¦ ì •ë³´ ìë™ ì£¼ì…
    let finalBody = body;
    if(method==='POST' && path !== '/dashboard/login'){
      finalBody = {
        ...(body||{}),
        role: S.role,
        password: S.role==='super' ? S.passwords.super : S.passwords.owner,
        roomId: S.roomId || (body&&body.roomId) || undefined
      };
    }
    const r=await fetch(S.apiUrl+path,{
      method, headers:{'Content-Type':'application/json'},
      body:finalBody?JSON.stringify(finalBody):undefined
    });
    if(r.ok){try{return await r.json()}catch{return{success:true}}}
    return null;
  }catch{return null;}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë¡œê·¸ì¸
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchRole(r){
  S.role=r;
  document.getElementById('tab-super').classList.toggle('on',r==='super');
  document.getElementById('tab-owner').classList.toggle('on',r==='owner');
  document.getElementById('superPwField').style.display=r==='super'?'flex':'none';
  document.getElementById('ownerFields').style.display=r==='owner'?'block':'none';
}

async function doLogin(){
  // í˜„ì¬ í˜ì´ì§€ë¥¼ ì„œë¹™í•œ ì„œë²„ ì£¼ì†Œë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš© (CORS ë¬¸ì œ ì—†ìŒ)
  S.apiUrl = window.location.protocol + '//' + window.location.hostname + ':9090';

  if(S.role==='super'){
    const pw=document.getElementById('inSuperPw').value;
    if(!pw){setErr('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');return;}

    // ì„œë²„ ì¸ì¦ ì‹œë„
    const res=await api('/dashboard/login','POST',{role:'super',password:pw});
    if(res?.success || pw===S.passwords.super){
      if(!res?.success) toast('âš  ë°ëª¨ ëª¨ë“œ (API ë¯¸ì—°ê²°)','wn');
      enterDash('super');
    }else{setErr('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');}

  }else{
    const pw=document.getElementById('inOwnerPw').value;
    const rid=document.getElementById('inRoomId').value.trim();
    if(!pw){setErr('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');return;}
    if(!rid){setErr('ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.');return;}

    const res=await api('/dashboard/login','POST',{role:'owner',password:pw,roomId:rid});
    if(res?.success || pw===S.passwords.owner){
      if(!res?.success) toast('âš  ë°ëª¨ ëª¨ë“œ (API ë¯¸ì—°ê²°)','wn');
      S.roomId=rid;
      enterDash('owner');
    }else{setErr('ë¹„ë°€ë²ˆí˜¸ ë˜ëŠ” ë°© IDê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');}
  }
}

function setErr(m){const e=document.getElementById('lerr');e.textContent=m;setTimeout(()=>e.textContent=' ',4000);}

function enterDash(role){
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('app').classList.add('show');

  // ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¸ì…˜ì— ë³´ê´€ (api() ìë™ ì£¼ì…ìš©)
  if(role==='super') S.passwords.super = document.getElementById('inSuperPw').value;
  else S.passwords.owner = document.getElementById('inOwnerPw').value;
  const url=S.apiUrl; const rname=role==='super'?'ğŸ‘‘ ì„œë²„ ê´€ë¦¬ì':'ğŸ  ë°©ì¥';
  document.getElementById('hApiUrl').textContent=url;
  document.getElementById('hRole').textContent=rname;
  document.getElementById('hRole').className='role-chip '+(role==='super'?'super':'owner');
  document.getElementById('iApi').textContent=url;
  document.getElementById('iRole').textContent=rname;
  document.getElementById('iTime').textContent=new Date().toLocaleString('ko-KR');
  document.getElementById('homeDesc').textContent=
    role==='super'
    ?'ì„œë²„ ê´€ë¦¬ìë¡œ ì ‘ì†í–ˆìŠµë‹ˆë‹¤. ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
    :`ë°©ì¥ìœ¼ë¡œ ì ‘ì†í–ˆìŠµë‹ˆë‹¤. ë°© ID: ${S.roomId}`;

  if(role==='owner'){
    document.getElementById('superNav').style.display='none';
    document.getElementById('iRoomRow').style.display='';
    document.getElementById('iRoom').textContent=S.roomId;
    // ë°©ì¥: ê³µì§€ ì „ì†¡ ì „ì²´ ì˜µì…˜ ì œê±°
    const sel=document.getElementById('ntcScope');
    sel.innerHTML='<option value="room">ë‚´ ë°© (ë°© ID: '+S.roomId+')</option>';
    sel.disabled=true;
    document.getElementById('ntcRoomId').value=S.roomId;
  }

  // ì„¤ì • í˜ì´ì§€ í˜„ì¬ ë¹„ë²ˆ í‘œì‹œ
  document.getElementById('showSuperPw').textContent=S.passwords.super;
  document.getElementById('showOwnerPw').textContent=S.passwords.owner;

  loadStats();
  addLog('system','ë¡œê·¸ì¸ ('+rname+') '+url);
}

function doLogout(){
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('app').classList.remove('show');
  S.role='super';S.roomId='';S.logs=[];S.apiUrl='';S.pendingAction=null;
  document.getElementById('superNav').style.display='block';
  document.getElementById('iRoomRow').style.display='none';
  // ê³µì§€ ì˜µì…˜ ì´ˆê¸°í™”
  const sel=document.getElementById('ntcScope');
  sel.innerHTML='<option value="all">ì „ì²´ ë°© (ë´‡ì´ ìˆëŠ” ëª¨ë“  ë°©)</option><option value="room">íŠ¹ì • ë°© ID</option>';
  sel.disabled=false;
  switchRole('super');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë‚´ë¹„ê²Œì´ì…˜
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function nav(name,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nv').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');
  if(el)el.classList.add('active');
  else{// ì‚¬ì´ë“œë°” ë§¤ì¹­
    document.querySelectorAll('.nv').forEach(n=>{if(n.getAttribute('onclick')?.includes("'"+name+"'"))n.classList.add('active');});
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í†µê³„
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadStats(){
  const d=await api('/dashboard/stats','GET');
  document.getElementById('stRooms').textContent=d?.rooms??'?';
  document.getElementById('stAdmins').textContent=d?.admins??'?';
  document.getElementById('stBans').textContent=d?.bans??'?';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë°´
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doBan(){
  const tgt=document.getElementById('banTgt').value.trim();
  const rsn=document.getElementById('banRsn').value.trim()||'ì‚¬ìœ  ì—†ìŒ';
  if(!tgt){toast('ì°¨ë‹¨í•  ìœ ì €ë¥¼ ì…ë ¥í•˜ì„¸ìš”.','er');return;}
  const res=await api('/dashboard/ban','POST',{target:tgt,reason:rsn,role:S.role});
  if(res?.success){toast(`âœ… ${tgt} ì°¨ë‹¨ ì™„ë£Œ`,'ok');addLog('ban',`ì°¨ë‹¨: ${tgt} (ì‚¬ìœ : ${rsn})`);}
  else{toast(`API ë¯¸ì—°ê²° â€” ë´‡ì— ì§ì ‘: !ban ${tgt}`,'wn');addLog('ban',`(ì˜¤í”„ë¼ì¸) ì°¨ë‹¨ ì‹œë„: ${tgt}`);}
  document.getElementById('banTgt').value='';document.getElementById('banRsn').value='';
  loadBanList();
}
async function doUnban(){
  const tgt=document.getElementById('unbanTgt').value.trim();
  if(!tgt){toast('í•´ì œí•  ìœ ì €ë¥¼ ì…ë ¥í•˜ì„¸ìš”.','er');return;}
  const res=await api('/dashboard/unban','POST',{target:tgt,role:S.role});
  if(res?.success){toast(`âœ… ${tgt} ì°¨ë‹¨ í•´ì œ`,'ok');addLog('ban',`í•´ì œ: ${tgt}`);}
  else toast(`API ë¯¸ì—°ê²° â€” ë´‡ì— ì§ì ‘: !unban ${tgt}`,'wn');
  document.getElementById('unbanTgt').value='';
  loadBanList();
}
async function loadBanList(){
  const d=await api('/dashboard/banlist','GET');
  const tb=document.getElementById('banTbody');
  if(d?.list?.length){
    tb.innerHTML=d.list.map((u,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${u.name||'ì•Œìˆ˜ì—†ìŒ'}</td>
        <td class="td-mono">${maskId(u.id)}</td>
        <td>${u.reason||'â€”'}</td>
        <td style="font-size:12px;color:var(--txt2)">${u.admin||'â€”'}</td>
        <td><button class="btn btn-ghost" style="padding:5px 10px;font-size:10px" onclick="qUnban('${u.id}','${u.name}')">í•´ì œ</button></td>
      </tr>`).join('');
  }else if(d?.list){
    tb.innerHTML='<tr class="empty-row"><td colspan="6">ì°¨ë‹¨ëœ ìœ ì €ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
  }else{
    tb.innerHTML='<tr class="empty-row"><td colspan="6">API ë¯¸ì—°ê²° ìƒíƒœì…ë‹ˆë‹¤</td></tr>';
  }
}
async function qUnban(id,name){
  const r=await api('/dashboard/unban','POST',{target:id,role:S.role});
  toast(r?.success?`âœ… ${name} í•´ì œ`:`ë´‡ì— ì§ì ‘: !unban ${id}`,r?.success?'ok':'wn');
  loadBanList();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ê³µì§€
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.getElementById('ntcScope').addEventListener('change',function(){
  document.getElementById('ntcRoomGrp').style.display=this.value==='room'?'flex':'none';
});
async function doNotice(){
  const msg=document.getElementById('ntcMsg').value.trim();
  if(!msg){toast('ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.','er');return;}
  const scope=document.getElementById('ntcScope').value;
  const rid=scope==='room'?document.getElementById('ntcRoomId').value.trim():null;
  if(scope==='room'&&!rid){toast('ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.','er');return;}
  const res=await api('/dashboard/notice','POST',{content:msg,scope,roomId:rid,role:S.role});
  if(res?.success){toast('âœ… ê³µì§€ ì „ì†¡ ì™„ë£Œ','ok');addLog('notice',`ê³µì§€ (${scope==='all'?'ì „ì²´':'ë°©'+rid}): ${msg.slice(0,30)}`);}
  else toast(`API ë¯¸ì—°ê²° â€” ë´‡ì— ì§ì ‘: !ê³µì§€ ${msg.slice(0,20)}`,'wn');
  document.getElementById('ntcMsg').value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ê´€ë¦¬ì ì„ëª…
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function doAddAdmin(){
  const tgt=document.getElementById('addAdmTgt').value.trim();
  if(!tgt){toast('ì„ëª…í•  ìœ ì €ë¥¼ ì…ë ¥í•˜ì„¸ìš”.','er');return;}
  const res=await api('/dashboard/addadmin','POST',{target:tgt,role:S.role});
  if(res?.success){toast(`âœ… ${tgt} ê´€ë¦¬ì ì„ëª…`,'ok');addLog('admin',`ê´€ë¦¬ì ì„ëª…: ${tgt}`);}
  else toast(`API ë¯¸ì—°ê²° â€” ë´‡ì— ì§ì ‘: !ê´€ë¦¬ìì„ëª… @${tgt}`,'wn');
  document.getElementById('addAdmTgt').value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë´‡ ì¬ì‹œì‘
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showRestartConfirm(){
  S.pendingAction='restart';
  document.getElementById('mTitle').textContent='ë´‡ ì¬ì‹œì‘';
  document.getElementById('mSub').textContent='ë´‡ ì„œë²„ë¥¼ ì¦‰ì‹œ ì¬ì‹œì‘í•©ë‹ˆë‹¤. ì ì‹œ ë™ì•ˆ ë´‡ì´ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?';
  document.getElementById('mOkBtn').textContent='ì¬ì‹œì‘';
  document.getElementById('mOkBtn').className='btn btn-o';
  document.getElementById('moverlay').classList.add('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ê´€ë¦¬ì ëª©ë¡ (ê´€ë¦¬ì ì „ìš©)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAdminList(){
  if(S.role!=='super'){toast('ì„œë²„ ê´€ë¦¬ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.','er');return;}
  const d=await api('/dashboard/adminlist','GET');
  const tb=document.getElementById('admTbody');
  if(d?.list?.length){
    tb.innerHTML=d.list.map((a,i)=>`
      <tr>
        <td>${i+1}</td>
        <td>${a.name||'â€”'}</td>
        <td><span class="badge ${a.role==='super'?'bsup':'badm'}">${a.role==='super'?'ì„œë²„ê´€ë¦¬ì':'ì¼ë°˜ê´€ë¦¬ì'}</span></td>
        <td class="td-mono">${a.room||'â€”'}</td>
        <td>${a.role!=='super'?`<button class="btn btn-r" style="padding:5px 10px;font-size:10px" onclick="removeAdm('${a.id}','${a.name}')">í•´ì œ</button>`:'<span style="font-size:11px;color:var(--txt2)">ë³´í˜¸</span>'}</td>
      </tr>`).join('');
  }else tb.innerHTML='<tr class="empty-row"><td colspan="5">API ë¯¸ì—°ê²° ìƒíƒœì…ë‹ˆë‹¤</td></tr>';
}
async function removeAdm(id,name){
  const r=await api('/dashboard/removeadmin','POST',{target:id});
  toast(r?.success?`âœ… ${name} í•´ì œ`:`ë´‡ì— ì§ì ‘: !ê´€ë¦¬ìí•´ì œ @${name}`,r?.success?'ok':'wn');
  addLog('admin',`ê´€ë¦¬ì í•´ì œ: ${name}`);
  loadAdminList();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë°© ëª©ë¡ (ê´€ë¦¬ì ì „ìš©)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadRooms(){
  if(S.role!=='super'){toast('ì„œë²„ ê´€ë¦¬ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.','er');return;}
  const d=await api('/dashboard/rooms','GET');
  const tb=document.getElementById('roomTbody');
  if(d?.rooms?.length){
    tb.innerHTML=d.rooms.map((r,i)=>`
      <tr>
        <td>${i+1}</td>
        <td class="td-mono">${r}</td>
        <td><button class="btn btn-ghost" style="padding:5px 10px;font-size:10px" onclick="quickNotice('${r}')">ê³µì§€</button></td>
      </tr>`).join('');
  }else tb.innerHTML='<tr class="empty-row"><td colspan="3">API ë¯¸ì—°ê²° ìƒíƒœì…ë‹ˆë‹¤</td></tr>';
}
function quickNotice(rid){
  nav('notice',null);
  document.getElementById('ntcScope').value='room';
  document.getElementById('ntcRoomGrp').style.display='flex';
  document.getElementById('ntcRoomId').value=rid;
  toast('ë°© IDê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.','ok');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (ê´€ë¦¬ì ì „ìš©)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function changePw(who){
  if(S.role!=='super'){toast('ì„œë²„ ê´€ë¦¬ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.','er');return;}
  const p1=document.getElementById(`new${who==='super'?'Super':'Owner'}Pw`).value;
  const p2=document.getElementById(`new${who==='super'?'Super':'Owner'}Pw2`).value;
  if(!p1){toast('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.','er');return;}
  if(p1!==p2){toast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.','er');return;}
  if(p1.length<6){toast('ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.','er');return;}

  // ì„œë²„ì— ì €ì¥ ì‹œë„
  const res=await api('/dashboard/setpw','POST',{role:who,password:p1});
  S.passwords[who]=p1;
  // í™”ë©´ ì—…ë°ì´íŠ¸
  document.getElementById(`show${who==='super'?'Super':'Owner'}Pw`).textContent=p1;
  toast(`âœ… ${who==='super'?'ê´€ë¦¬ì':'ë°©ì¥'} ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì™„ë£Œ`,'ok');
  addLog('system',`${who} ë¹„ë°€ë²ˆí˜¸ ë³€ê²½`);
  document.getElementById(`new${who==='super'?'Super':'Owner'}Pw`).value='';
  document.getElementById(`new${who==='super'?'Super':'Owner'}Pw2`).value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í™•ì¸ ëª¨ë‹¬ (ê´€ë¦¬ì ì „ìš© ìœ„í—˜ ì‘ì—…)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function confirmAct(action){
  if(S.role!=='super'){toast('ì„œë²„ ê´€ë¦¬ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.','er');return;}
  S.pendingAction=action;
  const map={
    clearAdmins:['ì¼ë°˜ ê´€ë¦¬ì ì „ì²´ í•´ì œ','ëª¨ë“  ì¼ë°˜ ê´€ë¦¬ì ê¶Œí•œì„ í•´ì œí•©ë‹ˆë‹¤. ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'],
    restart:['ë´‡ ì¬ì‹œì‘','ë´‡ ì„œë²„ë¥¼ ì¦‰ì‹œ ì¬ì‹œì‘í•©ë‹ˆë‹¤.'],
  };
  const[t,s]=map[action]||['í™•ì¸','ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'];
  document.getElementById('mTitle').textContent=t;
  document.getElementById('mSub').textContent=s;
  document.getElementById('mOkBtn').textContent='ì‹¤í–‰';
  document.getElementById('mOkBtn').className='btn btn-r';
  document.getElementById('moverlay').classList.add('show');
}
function closeModal(){document.getElementById('moverlay').classList.remove('show');S.pendingAction=null;}
async function execAction(){
  const a=S.pendingAction; closeModal(); if(!a)return;
  if(a==='restart'){
    const r=await api('/dashboard/restart','POST');
    toast(r?.success?'âœ… ì¬ì‹œì‘ ëª…ë ¹ ì „ì†¡':'API ë¯¸ì—°ê²° â€” ë´‡ì— ì§ì ‘: !ì¬ì‹œì‘',r?.success?'ok':'wn');
    addLog('system','ë´‡ ì¬ì‹œì‘ ëª…ë ¹');
  }else if(a==='clearAdmins'){
    const r=await api('/dashboard/clearadmins','POST');
    toast(r?.success?'âœ… ì¼ë°˜ ê´€ë¦¬ì ì „ì²´ í•´ì œ':'API ë¯¸ì—°ê²° â€” ë´‡ì— ì§ì ‘: !ê´€ë¦¬ìì´ˆê¸°í™”',r?.success?'ok':'wn');
    addLog('admin','ì¼ë°˜ ê´€ë¦¬ì ì „ì²´ í•´ì œ');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// í˜ì´ì§€ ì—´ë¦¬ìë§ˆì ì„œë²„ ì£¼ì†Œ ìë™ ê°ì§€í•´ì„œ í‘œì‹œ
window.addEventListener('DOMContentLoaded', () => {
  const autoUrl = window.location.protocol + '//' + window.location.hostname + ':9090';
  const label = document.getElementById('autoApiLabel');
  if(label) label.textContent = 'ì—°ê²° ì„œë²„: ' + autoUrl;
});

document.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const ls=document.getElementById('loginScreen');
    if(ls.style.display!=='none')doLogin();
  }
});
</script>
</body>
</html>
